{"version":3,"sources":["scripts/splash-screen.js"],"sourcesContent":["// This script is inlined in `_discourse_splash.html.erb\nconst DELAY_TARGET = 2000;\nconst POLLING_INTERVAL = 50;\n\nconst splashSvgTemplate = document.querySelector(\".splash-svg-template\");\nconst splashTemplateClone = splashSvgTemplate.content.cloneNode(true);\nconst svgElement = splashTemplateClone.querySelector(\"svg\");\n\nconst svgString = new XMLSerializer().serializeToString(svgElement);\nconst encodedSvg = btoa(svgString);\n\nconst splashWrapper = document.querySelector(\"#d-splash\");\nconst splashImage =\n  splashWrapper && splashWrapper.querySelector(\".preloader-image\");\n\nif (splashImage) {\n  splashImage.src = `data:image/svg+xml;base64,${encodedSvg}`;\n\n  const connectStart = performance.timing.connectStart || 0;\n  const targetTime = connectStart + DELAY_TARGET;\n\n  let splashInterval;\n  let discourseReady;\n\n  const swapSplash = () => {\n    splashWrapper &&\n      splashWrapper.style.setProperty(\"--animation-state\", \"running\");\n    svgElement && svgElement.style.setProperty(\"--animation-state\", \"running\");\n\n    const newSvgString = new XMLSerializer().serializeToString(svgElement);\n    const newEncodedSvg = btoa(newSvgString);\n\n    splashImage.src = `data:image/svg+xml;base64,${newEncodedSvg}`;\n\n    performance.mark(\"discourse-splash-visible\");\n\n    clearSplashInterval();\n  };\n\n  const clearSplashInterval = () => {\n    clearInterval(splashInterval);\n    splashInterval = null;\n  };\n\n  (() => {\n    splashInterval = setInterval(() => {\n      if (discourseReady) {\n        clearSplashInterval();\n      }\n\n      if (Date.now() > targetTime) {\n        swapSplash();\n      }\n    }, POLLING_INTERVAL);\n  })();\n\n  document.addEventListener(\n    \"discourse-ready\",\n    () => {\n      discourseReady = true;\n      splashWrapper && splashWrapper.remove();\n      performance.mark(\"discourse-splash-removed\");\n    },\n    { once: true }\n  );\n}\n"],"names":["DELAY_TARGET","POLLING_INTERVAL","splashSvgTemplate","document","querySelector","splashTemplateClone","content","cloneNode","svgElement","svgString","XMLSerializer","serializeToString","encodedSvg","btoa","splashWrapper","splashImage","src","connectStart","performance","timing","targetTime","splashInterval","discourseReady","swapSplash","style","setProperty","newSvgString","newEncodedSvg","mark","clearSplashInterval","clearInterval","setInterval","Date","now","addEventListener","remove","once"],"mappings":"AAAA;AACA,MAAMA,YAAY,GAAG,IAArB;AACA,MAAMC,gBAAgB,GAAG,EAAzB;AAEA,MAAMC,iBAAiB,GAAGC,QAAQ,CAACC,aAAT,CAAuB,sBAAvB,CAA1B;AACA,MAAMC,mBAAmB,GAAGH,iBAAiB,CAACI,OAAlB,CAA0BC,SAA1B,CAAoC,IAApC,CAA5B;AACA,MAAMC,UAAU,GAAGH,mBAAmB,CAACD,aAApB,CAAkC,KAAlC,CAAnB;AAEA,MAAMK,SAAS,GAAG,IAAIC,aAAJ,GAAoBC,iBAApB,CAAsCH,UAAtC,CAAlB;AACA,MAAMI,UAAU,GAAGC,IAAI,CAACJ,SAAD,CAAvB;AAEA,MAAMK,aAAa,GAAGX,QAAQ,CAACC,aAAT,CAAuB,WAAvB,CAAtB;AACA,MAAMW,WAAW,GACfD,aAAa,IAAIA,aAAa,CAACV,aAAd,CAA4B,kBAA5B,CADnB;;AAGA,IAAIW,WAAJ,EAAiB;EACfA,WAAW,CAACC,GAAZ,GAAmB,6BAA4BJ,UAAW,EAA1D;EAEA,MAAMK,YAAY,GAAGC,WAAW,CAACC,MAAZ,CAAmBF,YAAnB,IAAmC,CAAxD;EACA,MAAMG,UAAU,GAAGH,YAAY,GAAGjB,YAAlC;EAEA,IAAIqB,cAAJ;EACA,IAAIC,cAAJ;;EAEA,MAAMC,UAAU,GAAG,MAAM;IACvBT,aAAa,IACXA,aAAa,CAACU,KAAd,CAAoBC,WAApB,CAAgC,mBAAhC,EAAqD,SAArD,CADF;IAEAjB,UAAU,IAAIA,UAAU,CAACgB,KAAX,CAAiBC,WAAjB,CAA6B,mBAA7B,EAAkD,SAAlD,CAAd;IAEA,MAAMC,YAAY,GAAG,IAAIhB,aAAJ,GAAoBC,iBAApB,CAAsCH,UAAtC,CAArB;IACA,MAAMmB,aAAa,GAAGd,IAAI,CAACa,YAAD,CAA1B;IAEAX,WAAW,CAACC,GAAZ,GAAmB,6BAA4BW,aAAc,EAA7D;IAEAT,WAAW,CAACU,IAAZ,CAAiB,0BAAjB;IAEAC,mBAAmB;EACpB,CAbD;;EAeA,MAAMA,mBAAmB,GAAG,MAAM;IAChCC,aAAa,CAACT,cAAD,CAAb;IACAA,cAAc,GAAG,IAAjB;EACD,CAHD;;EAKA,CAAC,MAAM;IACLA,cAAc,GAAGU,WAAW,CAAC,MAAM;MACjC,IAAIT,cAAJ,EAAoB;QAClBO,mBAAmB;MACpB;;MAED,IAAIG,IAAI,CAACC,GAAL,KAAab,UAAjB,EAA6B;QAC3BG,UAAU;MACX;IACF,CAR2B,EAQzBtB,gBARyB,CAA5B;EASD,CAVD;;EAYAE,QAAQ,CAAC+B,gBAAT,CACE,iBADF,EAEE,MAAM;IACJZ,cAAc,GAAG,IAAjB;IACAR,aAAa,IAAIA,aAAa,CAACqB,MAAd,EAAjB;IACAjB,WAAW,CAACU,IAAZ,CAAiB,0BAAjB;EACD,CANH,EAOE;IAAEQ,IAAI,EAAE;EAAR,CAPF;AASD;","file":"splash-screen.js"}